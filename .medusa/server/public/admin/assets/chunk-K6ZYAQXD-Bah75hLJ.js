import{u as ke}from"./chunk-C76H5USB-Di1OZBXz.js";import{b as de,d as ue,bp as ee,r as d,ao as Oe,u as Le,c7 as Ie,j as e,c8 as v,H as fe,_ as he,A as Ke,B,L as Re,g as $e,aj as re,bD as b,aL as qe,P as Be,T as ze,t as I,c9 as Ue,ca as Ye,cb as Je,cc as Qe,cd as Xe,ce as We,ay as Ce,b_ as S,a0 as Ge,Y as Ze,cf as He}from"./index-Bxfpjf1r.js";var z=(s,a)=>{let t=a;t||(s instanceof He||s.message?t=s.message:t="An error occurred"),I.error(t)},xe=s=>{const a=ue("view_configurations"),t=Ue(s,{limit:100},{enabled:a&&!!s}),n=Ye(s,{enabled:a&&!!s}),c=Je(s,{onSuccess:()=>{I.success("View created")},onError:g=>{z(g,"Failed to create view")}}),h=Qe(s,{onSuccess:()=>{},onError:g=>{z(g,"Failed to update active view")}});return d.useMemo(()=>({isViewConfigEnabled:a,listViews:t,activeView:n,createView:c,setActiveView:h,isDefaultViewActive:(n==null?void 0:n.is_default_active)??!0}),[a,t,n,c,h])},me=(s,a)=>{const t=Xe(s,a,{onSuccess:()=>{I.success("View updated")},onError:c=>{z(c,"Failed to update view")}}),n=We(s,a,{onSuccess:()=>{I.success("View deleted successfully")},onError:c=>{z(c,"Failed to delete view")}});return{updateView:t,deleteView:n}},es=({entity:s,currentColumns:a,currentConfiguration:t,editingView:n,onClose:c,onSaved:h})=>{const{createView:g}=xe(s),{updateView:D}=me(s,(n==null?void 0:n.id)||""),[P,j]=d.useState(!1),{register:T,handleSubmit:_,formState:{errors:w}}=Ce({defaultValues:{name:(n==null?void 0:n.name)||""}}),u=async f=>{if(f.name.trim()){j(!0);try{if(n){const p=await D.mutateAsync({name:f.name.trim(),configuration:{visible_columns:(a==null?void 0:a.visible)||n.configuration.visible_columns,column_order:(a==null?void 0:a.order)||n.configuration.column_order,filters:(t==null?void 0:t.filters)||n.configuration.filters||{},sorting:(t==null?void 0:t.sorting)||n.configuration.sorting||null,search:(t==null?void 0:t.search)||n.configuration.search||""}});h(p.view_configuration)}else{const p=await g.mutateAsync({name:f.name.trim(),set_active:!0,configuration:{visible_columns:(a==null?void 0:a.visible)||[],column_order:(a==null?void 0:a.order)||[],filters:(t==null?void 0:t.filters)||{},sorting:(t==null?void 0:t.sorting)||null,search:(t==null?void 0:t.search)||""}});h(p.view_configuration)}}catch{}finally{j(!1)}}};return e.jsx(S,{open:!0,onOpenChange:c,children:e.jsxs(S.Content,{className:"flex flex-col",children:[e.jsxs(S.Header,{children:[e.jsx(S.Title,{asChild:!0,children:e.jsx(fe,{children:n?"Edit View Name":"Save as New View"})}),e.jsx(S.Description,{asChild:!0,children:e.jsx(he,{children:n?"Change the name of your saved view":"Save your current configuration as a new view"})})]}),e.jsxs("form",{onSubmit:_(u),className:"flex flex-1 flex-col",children:[e.jsx(S.Body,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(Ge,{htmlFor:"name",weight:"plus",children:"View Name"}),e.jsx(Ze,{...T("name",{required:"Name is required",validate:f=>f.trim().length>0||"Name cannot be empty"}),type:"text",placeholder:"Enter view name",autoFocus:!0}),w.name&&e.jsx("span",{className:"text-sm text-ui-fg-error",children:w.name.message})]})}),e.jsxs(S.Footer,{children:[e.jsx(S.Close,{asChild:!0,children:e.jsx(B,{variant:"secondary",size:"small",type:"button",children:"Cancel"})}),e.jsx(B,{variant:"primary",size:"small",type:"submit",isLoading:P,children:n?"Update":"Save"})]})]})]})})},ss=({entity:s,currentColumns:a,currentConfiguration:t})=>{const{listViews:n,activeView:c,setActiveView:h,isDefaultViewActive:g}=xe(s),D=(n==null?void 0:n.view_configurations)||[],[P,j]=d.useState(!1),[T,_]=d.useState(null),[w,u]=d.useState(null),[f,p]=d.useState({x:0,y:0}),[A,r]=d.useState(null),M=$e(),k=(c==null?void 0:c.view_configuration)||null,{deleteView:O}=me(s,A||""),K=async l=>{try{if(l===null){await h.mutateAsync(null);return}D.find(J=>J.id===l)&&await h.mutateAsync(l)}catch(m){console.error("Error in handleViewSelect:",m)}},U=async l=>{await M({title:"Delete view",description:`Are you sure you want to delete "${l.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"})&&r(l.id)};d.useEffect(()=>{A&&O.mutateAsync&&O.mutateAsync().then(()=>{r(null)}).catch(()=>{r(null)})},[A,O.mutateAsync]);const Y=l=>{_(l),j(!0)},E=async l=>{await M({title:"Reset system default",description:"This will delete the saved system default and revert to the original code-level defaults. All users will be affected. Are you sure?",confirmText:"Reset",cancelText:"Cancel"})&&r(l.id)},y=D.find(l=>l.is_system_default),L=D.filter(l=>!l.is_system_default),R=g;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:R?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>K(null),onContextMenu:l=>{l.preventDefault(),y&&(p({x:l.clientX,y:l.clientY}),u("default"))},children:"Default"}),y&&w==="default"&&e.jsxs(b,{open:!0,onOpenChange:l=>{l||u(null)},children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsx(b.Content,{align:"start",sideOffset:0,children:e.jsxs(b.Item,{onClick:()=>{E(y),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(qe,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Reset to code defaults"})]})})]})]}),L.length>0&&e.jsx("div",{className:"text-ui-fg-muted",children:"|"}),L.map(l=>e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:(k==null?void 0:k.id)===l.id?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>K(l.id),onContextMenu:m=>{m.preventDefault(),p({x:m.clientX,y:m.clientY}),u(l.id)},children:l.name}),w===l.id&&e.jsxs(b,{open:!0,onOpenChange:m=>{m||u(null)},children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsxs(b.Content,{align:"start",sideOffset:0,children:[e.jsxs(b.Item,{onClick:()=>{Y(l),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(Be,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Edit name"})]}),e.jsxs(b.Item,{onClick:()=>{U(l),u(null)},className:"flex items-center gap-x-2 text-ui-fg-error",children:[e.jsx(ze,{}),e.jsx("span",{children:"Delete"})]})]})]})]},l.id))]}),P&&e.jsx(es,{entity:s,currentColumns:a,currentConfiguration:t,editingView:T,onClose:()=>{j(!1),_(null)},onSaved:async l=>{j(!1),_(null),I.success(`View "${l.name}" saved successfully`)}})]})},fs=({data:s=[],columns:a,filters:t,commands:n,action:c,actions:h,actionMenu:g,getRowId:D,rowCount:P=0,enablePagination:j=!0,enableSearch:T=!0,autoFocusSearch:_=!1,enableFilterMenu:w,rowHref:u,heading:f,headingLevel:p="h1",subHeading:A,prefix:r,pageSize:M=10,emptyState:k,rowSelection:O,isLoading:K=!1,layout:U="auto",enableColumnVisibility:Y=!1,initialColumnVisibility:E={},onColumnVisibilityChange:y,columnOrder:L,onColumnOrderChange:R,enableViewSelector:se=!1,entity:l,currentColumns:m,filterBarContent:J})=>{const{t:je}=de(),te=ue("view_configurations"),ae=te&&Y,pe=te&&se,ne=t&&t.length>0,be=w!==void 0?w:ne,we=n&&n.length>0,Q=a.some(i=>i.enableSorting),[X,le]=ee.useState(E);ee.useEffect(()=>{const i=Object.keys(X).sort(),o=Object.keys(E).sort();(i.length!==o.length||i.some((F,V)=>F!==o[V])||Object.entries(E).some(([F,V])=>X[F]!==V))&&le(E)},[E]);const ye=ee.useCallback(i=>{le(i),y==null||y(i)},[y]),$=d.useMemo(()=>(t==null?void 0:t.map(i=>i.id))??[],[t]),ve=$.map(i=>N(i,r)),{offset:W,order:C,q:ie,...oe}=ke([...$,...Q?["order"]:[],...T?["q"]:[],...j?["offset"]:[]],r),[rs,q]=Oe(),G=d.useMemo(()=>ie??"",[ie]),Se=i=>{q(o=>(i?o.set(N("q",r),i):o.delete(N("q",r)),o))},Ne=d.useMemo(()=>W?ls(W,M):{pageIndex:0,pageSize:M},[W,M]),De=i=>{q(o=>(i.pageIndex===0?o.delete(N("offset",r)):o.set(N("offset",r),ns(i).toString()),o))},Z=d.useMemo(()=>is($,oe),[$,oe]),Te=i=>{q(o=>(Array.from(o.keys()).forEach(x=>{ve.includes(x)&&((r?x.replace(`${r}_`,""):x)in i||o.delete(x))}),Object.entries(i).forEach(([x,F])=>{const V=N(x,r);F!==void 0?o.set(V,JSON.stringify(F)):o.delete(V)}),o))},H=d.useMemo(()=>C?as(C):null,[C]),_e=d.useMemo(()=>({filters:Z,sorting:H,search:G}),[Z,H,G]),Ae=i=>{q(o=>{if(i){const x=ts(i);o.set(N("order",r),x)}else o.delete(N("order",r));return o})},{pagination:Ee,toolbar:Fe}=os(),ce=Le(),Me=d.useCallback((i,o)=>{if(!u)return;const x=u(o);if(i.metaKey||i.ctrlKey||i.button===1){window.open(x,"_blank","noreferrer");return}if(i.shiftKey){window.open(x,void 0,"noreferrer");return}ce(x)},[ce,u]),Ve=Ie({data:s,columns:a,filters:t,commands:n,rowCount:P,getRowId:D,onRowClick:u?Me:void 0,pagination:j?{state:Ne,onPaginationChange:De}:void 0,filtering:ne?{state:Z,onFilteringChange:Te}:void 0,sorting:Q?{state:H,onSortingChange:Ae}:void 0,search:T?{state:G,onSearchChange:Se}:void 0,rowSelection:O,isLoading:K,columnVisibility:ae?{state:X,onColumnVisibilityChange:ye}:void 0,columnOrder:ae&&L&&R?{state:L,onColumnOrderChange:R}:void 0}),Pe=f||A;return e.jsxs(v,{instance:Ve,className:U==="fill"?"h-full [&_tr]:last-of-type:!border-b":void 0,children:[e.jsx(v.Toolbar,{className:"flex flex-col items-start justify-between gap-2 md:flex-row md:items-center",translations:Fe,filterBarContent:J,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-x-4",children:[Pe&&e.jsxs("div",{children:[f&&e.jsx(fe,{level:p,children:f}),A&&e.jsx(he,{size:"small",className:"text-ui-fg-subtle",children:A})]}),pe&&l&&e.jsx(ss,{entity:l,currentColumns:m,currentConfiguration:_e})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[be&&e.jsx(v.FilterMenu,{}),Q&&e.jsx(v.SortingMenu,{}),T&&e.jsx("div",{className:"w-full md:w-auto",children:e.jsx(v.Search,{placeholder:je("filters.searchLabel"),autoFocus:_})}),g&&e.jsx(Ke,{variant:"primary",...g}),h&&h.length>0&&e.jsx(cs,{actions:h}),!h&&c&&e.jsx(ge,{...c})]})]})}),e.jsx(v.Table,{emptyState:k}),j&&e.jsx(v.Pagination,{translations:Ee}),we&&e.jsx(v.CommandBar,{selectedLabel:i=>`${i} selected`})]})};function ts(s){return s.desc?`-${s.id}`:s.id}function as(s){return s.startsWith("-")?{id:s.slice(1),desc:!0}:{id:s,desc:!1}}function ns(s){return s.pageIndex*s.pageSize}function ls(s,a){const t=parseInt(s);return{pageIndex:Math.floor(t/a),pageSize:a}}function is(s,a){if(!a)return{};const t={};for(const n of s){const c=a[n];c!==void 0&&(t[n]=JSON.parse(c))}return t}function N(s,a){return a?`${a}_${s}`:s}var os=()=>{const{t:s}=de(),a={of:s("general.of"),results:s("general.results"),pages:s("general.pages"),prev:s("general.prev"),next:s("general.next")},t={clearAll:s("actions.clearAll"),sort:s("filters.sortLabel"),columns:"Columns"};return{pagination:a,toolbar:t}},ge=({label:s,disabled:a,...t})=>{const n={size:"small",disabled:a??!1,type:"button",variant:"secondary"};return"to"in t?e.jsx(B,{...n,asChild:!0,children:e.jsx(Re,{to:t.to,children:s})}):e.jsx(B,{...n,onClick:t.onClick,children:s})},cs=({actions:s})=>e.jsx("div",{className:"flex items-center gap-x-2",children:s.map((a,t)=>e.jsx(ge,{...a},t))});export{fs as D,es as S,me as a,xe as u};
