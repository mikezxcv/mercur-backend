import{K as k}from"./chunk-6HTZNHPT-BHsf02UK.js";import{R as c,u as v}from"./chunk-AERWK3TJ-2NOSGJWi.js";import{ar as _,aD as C,at as b,au as F,ac as S,dn as w,j as e,b as E,dV as L,ay as M,az as I,Z as T,t as y,H,I as x,X as s,Y as g,B as f,aB as $}from"./index-Bxfpjf1r.js";var z=_({labels:C(_({tracking_number:b(),tracking_url:b().optional(),label_url:b().optional()})),send_notification:F().optional()});function B({order:d,fulfillment:n}){const{t:r}=E(),{handleSuccess:h}=v(),{mutateAsync:u,isPending:j}=L(d.id,n==null?void 0:n.id),i=M({defaultValues:{send_notification:!d.no_notification},resolver:I(z)}),{fields:m,append:p}=T({name:"labels",control:i.control}),N=i.handleSubmit(async o=>{var t;const l=o.labels.filter(a=>!!a.tracking_number||!!a.tracking_url||!!a.label_url).map(a=>({tracking_number:a.tracking_number,tracking_url:a.tracking_url||"#",label_url:a.label_url||"#"}));await u({items:(t=n==null?void 0:n.items)==null?void 0:t.map(a=>({id:a.line_item_id,quantity:a.quantity})),labels:[...l,...(n==null?void 0:n.labels)||[]],no_notification:!o.send_notification},{onSuccess:()=>{y.success(r("orders.shipment.toastCreated")),h(`/orders/${d.id}`)},onError:a=>{y.error(a.message)}})});return e.jsx(c.Form,{form:i,children:e.jsxs(k,{onSubmit:N,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(c.Header,{}),e.jsx(c.Body,{className:"flex h-full w-full flex-col items-center divide-y overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsx("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(H,{className:"mb-4",children:r("orders.shipment.title")}),e.jsx("div",{className:"flex flex-col max-md:gap-y-2 max-md:divide-y",children:m.map((o,l)=>e.jsxs("div",{className:x("grid grid-cols-1 gap-x-4 md:grid-cols-3",{"max-md:pt-4":l>0}),children:[e.jsx(s.Field,{control:i.control,name:`labels.${l}.tracking_number`,render:({field:t})=>e.jsxs(s.Item,{className:"mb-2",children:[e.jsx(s.Label,{className:x({"md:hidden":l>0}),children:r("orders.shipment.trackingNumber")}),e.jsx(s.Control,{children:e.jsx(g,{...t,placeholder:"123-456-789"})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:`labels.${l}.tracking_url`,render:({field:t})=>e.jsxs(s.Item,{className:"mb-2",children:[e.jsx(s.Label,{className:x({"md:hidden":l>0}),children:r("orders.shipment.trackingUrl")}),e.jsx(s.Control,{children:e.jsx(g,{...t,placeholder:"https://example.com/tracking/123"})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:`labels.${l}.label_url`,render:({field:t})=>e.jsxs(s.Item,{className:"mb-2",children:[e.jsx(s.Label,{className:x({"md:hidden":l>0}),children:r("orders.shipment.labelUrl")}),e.jsx(s.Control,{children:e.jsx(g,{...t,placeholder:"https://example.com/label/123"})}),e.jsx(s.ErrorMessage,{})]})})]},o.id))}),e.jsx(f,{type:"button",onClick:()=>p({tracking_number:"",label_url:"",tracking_url:""}),className:"mt-2 self-end",variant:"secondary",children:r("orders.shipment.addTracking")})]}),e.jsx("div",{className:"mt-8 pt-8 ",children:e.jsx(s.Field,{control:i.control,name:"send_notification",render:({field:{onChange:o,value:l,...t}})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{children:r("orders.shipment.sendNotification")}),e.jsx(s.Control,{children:e.jsx(s.Control,{children:e.jsx($,{dir:"ltr",className:"rtl:rotate-180",checked:!!l,onCheckedChange:o,...t})})})]}),e.jsx(s.Hint,{className:"!mt-1",children:r("orders.shipment.sendNotificationHint")}),e.jsx(s.ErrorMessage,{})]})})})]})})})}),e.jsxs(c.Footer,{children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(f,{size:"small",variant:"secondary",children:r("actions.cancel")})}),e.jsx(f,{size:"small",type:"submit",isLoading:j,children:r("actions.save")})]})]})})}function A(){var m;const{id:d,f_id:n}=S(),{order:r,isLoading:h,isError:u,error:j}=w(d,{fields:"*fulfillments,*fulfillments.items,*fulfillments.labels"});if(u)throw j;const i=!h&&r;return e.jsx(c,{children:i&&e.jsx(B,{order:r,fulfillment:(m=r.fulfillments)==null?void 0:m.find(p=>p.id===n)})})}export{A as Component};
